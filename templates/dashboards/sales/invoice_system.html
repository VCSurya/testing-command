<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Invoice Billing System</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
            color: #333;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .section {
            background: white;
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
            border: 1px solid #e5e5e5;
        }

        .section-header {
            display: flex;
            align-items: center;
            margin-bottom: 20px;
            font-weight: 600;
            font-size: 16px;
            color: #333;
        }

        .section-header .icon {
            margin-right: 12px;
            font-size: 18px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #555;
            font-size: 14px;
        }

        .form-input, .form-select, .form-textarea {
            width: 100%;
            padding: 12px 16px;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s ease;
            background: white;
        }

        .form-input:focus, .form-select:focus, .form-textarea:focus {
            outline: none;
            border-color: #4f46e5;
        }

        .form-select {
            cursor: pointer;
            appearance: none;
            background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='M6 8l4 4 4-4'/%3e%3c/svg%3e");
            background-position: right 12px center;
            background-repeat: no-repeat;
            background-size: 16px;
            padding-right: 40px;
        }

        .form-textarea {
            resize: vertical;
            min-height: 80px;
        }

        /* Searchable Dropdown Styles */
        .search-dropdown {
            position: relative;
        }

        .search-input {
            width: 100%;
            padding: 12px 40px 12px 16px;
            border: 2px solid #e5e5e5;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s ease;
            background: white;
        }

        .search-input:focus {
            outline: none;
            border-color: #4f46e5;
        }

        .search-icon {
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
            color: #6b7280;
            pointer-events: none;
        }

        .dropdown-list {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #e5e5e5;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 200px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
        }

        .dropdown-list.show {
            display: block;
        }

        .dropdown-item {
            padding: 12px 16px;
            cursor: pointer;
            border-bottom: 1px solid #f3f4f6;
            transition: background-color 0.2s ease;
        }

        .dropdown-item:hover {
            background-color: #f8f9fa;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .btn {
            padding: 12px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background-color: #4f46e5;
            color: white;
            width: 100%;
        }

        .btn-primary:hover {
            background-color: #4338ca;
        }

        .btn-secondary {
            background-color: #f8f9fa;
            color: #333;
            border: 2px solid #e5e5e5;
            width: 100%;
        }

        .btn-secondary:hover {
            background-color: #e9ecef;
        }

        .btn-dark {
            background-color: #374151;
            color: white;
            width: 100%;
        }

        .btn-dark:hover {
            background-color: #1f2937;
        }

        .btn-success {
            background-color: #10b981;
            color: white;
            width: 100%;
        }

        .btn-success:hover {
            background-color: #059669;
        }

        .btn-danger {
            background-color: #ef4444;
            color: white;
            width: 100%;
        }

        .btn-danger:hover {
            background-color: #dc2626;
        }

        /* Product Table Styles */
        .product-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
        }

        .product-table th {
            background-color: #4a5568;
            color: white;
            padding: 12px 16px;
            text-align: left;
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .product-table td {
            padding: 16px;
            border-bottom: 1px solid #e2e8f0;
            vertical-align: middle;
        }

        .product-table tbody tr:hover {
            background-color: #f8f9fa;
        }

        .product-table tbody tr:last-child td {
            border-bottom: none;
        }

        .product-name {
            font-weight: 600;
            color: #2d3748;
        }

        .product-price {
            font-weight: 500;
            color: #4a5568;
        }

        /* Quantity Controls */
        .quantity-controls {
            display: flex;
            align-items: center;
            gap: 8px;
            justify-content: center;
        }

        .quantity-btn {
            background: #4f46e5;
            color: white;
            border: none;
            border-radius: 50%;
            width: 28px;
            height: 28px;
            cursor: pointer;
            font-size: 16px;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            user-select: none;
        }

        .quantity-btn:hover {
            background: #4338ca;
            transform: scale(1.05);
        }

        .quantity-btn:active {
            transform: scale(0.95);
        }

        .quantity-input {
            width: 50px;
            padding: 6px 8px;
            border: 1px solid #e2e8f0;
            border-radius: 4px;
            text-align: center;
            font-size: 14px;
            font-weight: 500;
        }

        .quantity-input:focus {
            outline: none;
            border-color: #4f46e5;
        }

        .total-amount {
            font-weight: 600;
            color: #2d3748;
        }

        .remove-btn {
            background: #ef4444;
            color: white;
            border: none;
            border-radius: 6px;
            width: 36px;
            height: 36px;
            cursor: pointer;
            font-size: 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(239, 68, 68, 0.2);
        }

        .remove-btn:hover {
            background: #dc2626;
            transform: translateY(-1px);
            box-shadow: 0 4px 8px rgba(239, 68, 68, 0.3);
        }

        .remove-btn:active {
            transform: translateY(0);
        }

        .empty-table {
            text-align: center;
            padding: 40px 20px;
            color: #9ca3af;
        }

        .empty-table .icon {
            font-size: 48px;
            margin-bottom: 12px;
            opacity: 0.5;
        }

        .tax-section {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 20px;
        }

        .tax-label {
            flex: 1;
            font-weight: 500;
        }

        .btn-apply {
            padding: 8px 16px;
            background-color: #f8f9fa;
            border: 2px solid #e5e5e5;
            border-radius: 6px;
            font-size: 13px;
            cursor: pointer;
        }

        .total-section {
            border-top: 1px solid #e5e5e5;
            padding-top: 20px;
        }

        .total-row {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-size: 14px;
        }

        .grand-total {
            display: flex;
            justify-content: space-between;
            font-weight: 600;
            font-size: 16px;
            padding-top: 12px;
            border-top: 2px solid #e5e5e5;
        }

        /* Toast Style */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            border-radius: 8px;
            padding: 16px 20px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
            border-left: 4px solid #10b981;
            z-index: 1000;
            transform: translateX(400px);
            transition: transform 0.3s ease;
            max-width: 350px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            border-left-color: #ef4444;
        }

        .toast.warning {
            border-left-color: #f59e0b;
        }

        .toast-icon {
            font-size: 18px;
        }

        .toast-content {
            flex: 1;
        }

        .toast-title {
            font-weight: 600;
            font-size: 14px;
            margin-bottom: 4px;
        }

        .toast-message {
            font-size: 13px;
            color: #666;
        }

        .toast-close {
            background: none;
            border: none;
            font-size: 18px;
            cursor: pointer;
            color: #999;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Modal Style */
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .modal.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 12px;
            padding: 24px;
            width: 90%;
            max-width: 500px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            font-weight: 600;
            font-size: 18px;
            margin-bottom: 16px;
            color: #333;
        }

        .modal-body {
            margin-bottom: 20px;
        }

        .modal-footer {
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        .btn-modal {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            font-size: 14px;
            cursor: pointer;
            font-weight: 500;
        }

        .btn-cancel {
            background: #f3f4f6;
            color: #374151;
        }

        .btn-confirm {
            background: #4f46e5;
            color: white;
        }

        .btn-actions {
            display: flex;
            gap: 12px;
            margin-top: 20px;
        }

        /* Confirmation Modal Styles */
        .confirmation-modal .modal-header {
            display: flex;
            align-items: center;
            gap: 12px;
            color: #ef4444;
        }

        .confirmation-modal .modal-body {
            color: #666;
            line-height: 1.6;
        }

        .confirmation-modal .btn-delete {
            background: #ef4444;
            color: white;
        }

        .confirmation-modal .btn-delete:hover {
            background: #dc2626;
        }

        /* Mobile Responsive */
        @media (max-width: 768px) {
            .container {
                grid-template-columns: 1fr;
                gap: 16px;
            }

            .section {
                padding: 20px;
            }

            body {
                padding: 16px;
            }

            .tax-section {
                flex-direction: column;
                align-items: stretch;
            }

            .btn-apply {
                width: 100%;
                justify-content: center;
            }

            .btn-actions {
                flex-direction: column;
            }

            .product-table {
                font-size: 12px;
            }

            .product-table th,
            .product-table td {
                padding: 8px;
            }

            .quantity-controls {
                flex-direction: column;
                gap: 4px;
            }
        }

        @media (max-width: 480px) {
            .section {
                padding: 16px;
            }

            .section-header {
                font-size: 14px;
            }

            .form-input, .form-select {
                padding: 10px 12px;
                font-size: 14px;
            }
        }
    </style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
</head>
<body>
    <div class="container">

        <div style="display: flex; flex-direction: column; gap: 20px;">
            <!-- Customer Details Section -->
            <div class="section">
                <div class="section-header">
                    <span class="icon">üë§</span>
                    CUSTOMER DETAILS
                    <div>
                        <i class="bi bi-plus-circle"></i>
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Select Customer</label>
                    <div class="search-dropdown">
                        <input type="text" class="search-input" id="customerSearch" placeholder="Search and select customer" autocomplete="off">
                        <span class="search-icon">üîç</span>
                        <div class="dropdown-list" id="customerDropdown"></div>
                    </div>
                </div>
                
                <button class="btn btn-secondary" onclick="openCustomerModal()">
                    <span>+</span>
                    Add New Customer
                </button>
            </div>

            <!-- Delivery Mode Section -->
            <div class="section">
                <div class="section-header">
                    <span class="icon">üöö</span>
                    DELIVERY MODE
                </div>
                
                <div class="form-group">
                    <label class="form-label">Select Delivery Method</label>
                    <select class="form-select" id="deliveryMethod">
                        <option value="">Select delivery mode</option>
                        <option value="standard">Through Porter</option>
                        <option value="express">Through Transport</option>
                        <option value="pickup">Store Pickup</option>
                        <option value="same-day">Through Postal Service</option>
                    </select>
                </div>
            </div>

            <!-- Payment Details Section -->
            <div class="section">
                <div class="section-header">
                    <span class="icon">üí≥</span>
                    PAYMENT DETAILS
                </div>
                
                <div class="form-group">
                    <label class="form-label">Payment Mode</label>
                    <select class="form-select" id="paymentMode">
                        <option value="">Select payment mode</option>
                        <option value="cash">Cash</option>
                        <option value="card">Credit/Debit Card</option>
                        <option value="upi">UPI</option>
                        <option value="netbanking">Net Banking</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Payment Type</label>
                    <select class="form-select" id="paymentType">
                        <option value="">Select payment type</option>
                        <option value="full">Full Payment</option>
                        <option value="partial">Partial Payment</option>
                        <option value="advance">Advance Payment</option>
                    </select>
                </div>
                
                <button class="btn btn-secondary" onclick="openPaymentNoteModal()">
                    <span>üìù</span>
                    Add Payment Note
                </button>
            </div>
        </div>

        <!-- Add Products Section -->
        <div class="section">
            <div class="section-header">
                <span class="icon">üõí</span>
                PRODUCT TABLE
            </div>
            
            <button class="btn btn-dark" onclick="openProductModal()" style="margin-bottom: 20px;">
                <span>+</span>
                Add Product
            </button>
            
            <div style="margin-top: 24px;">
                <table class="product-table" id="productTable">
                    <thead>
                        <tr>
                            <th>Product Name</th>
                            <th>Price</th>
                            <th>Quantity</th>
                            <th>Total</th>
                            <th>Action</th>
                        </tr>
                    </thead>
                    <tbody id="productTableBody">
                        <tr>
                            <td colspan="5" class="empty-table">
                                <div class="icon">üõí</div>
                                <div>No products added yet</div>
                                <div style="font-size: 12px; margin-top: 8px;">Click "Add Product" to add items to your invoice</div>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tax & Total Section -->
        <div class="section">
            <div class="section-header">
                <span class="icon">üìä</span>
                TAX & TOTAL
            </div>
            
            <div class="tax-section">
                <span class="tax-label">Apply Tax (18%)</span>
                <button class="btn-apply" onclick="applyTax()">Apply</button>
            </div>
            
            <div class="total-section">
                <div class="total-row">
                    <span>Subtotal:</span>
                    <span id="subtotal">‚Çπ0.00</span>
                </div>
                <div class="grand-total">
                    <span>GRAND TOTAL:</span>
                    <span id="grandTotal">‚Çπ0.00</span>
                </div>
            </div>

            <!-- Action Buttons -->
            <div class="btn-actions">
                <button class="btn btn-success" onclick="saveBill()">
                    <span>üíæ</span>
                    Save Bill
                </button>
                <button class="btn btn-danger" onclick="openClearConfirmation()">
                    <span>üóëÔ∏è</span>
                    Clear All
                </button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div id="toastContainer"></div>

    <!-- Modal for Adding Customer -->
    <div id="customerModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Add New Customer</div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Customer Name</label>
                    <input type="text" class="form-input" id="newCustomerName" placeholder="Enter customer name">
                </div>
                <div class="form-group">
                    <label class="form-label">Address</label>
                    <textarea class="form-textarea" id="newCustomerAddress" placeholder="Enter customer address"></textarea>
                </div>
                <div class="form-group">
                    <label class="form-label">State</label>
                    <select class="form-select" id="newCustomerState">
                        <option value="">Select State</option>
                        <option value="Andhra Pradesh">Andhra Pradesh</option>
                        <option value="Arunachal Pradesh">Arunachal Pradesh</option>
                        <option value="Assam">Assam</option>
                        <option value="Bihar">Bihar</option>
                        <option value="Chhattisgarh">Chhattisgarh</option>
                        <option value="Goa">Goa</option>
                        <option value="Gujarat">Gujarat</option>
                        <option value="Haryana">Haryana</option>
                        <option value="Himachal Pradesh">Himachal Pradesh</option>
                        <option value="Jharkhand">Jharkhand</option>
                        <option value="Karnataka">Karnataka</option>
                        <option value="Kerala">Kerala</option>
                        <option value="Madhya Pradesh">Madhya Pradesh</option>
                        <option value="Maharashtra">Maharashtra</option>
                        <option value="Manipur">Manipur</option>
                        <option value="Meghalaya">Meghalaya</option>
                        <option value="Mizoram">Mizoram</option>
                        <option value="Nagaland">Nagaland</option>
                        <option value="Odisha">Odisha</option>
                        <option value="Punjab">Punjab</option>
                        <option value="Rajasthan">Rajasthan</option>
                        <option value="Sikkim">Sikkim</option>
                        <option value="Tamil Nadu">Tamil Nadu</option>
                        <option value="Telangana">Telangana</option>
                        <option value="Tripura">Tripura</option>
                        <option value="Uttar Pradesh">Uttar Pradesh</option>
                        <option value="Uttarakhand">Uttarakhand</option>
                        <option value="West Bengal">West Bengal</option>
                        <option value="Andaman and Nicobar Islands">Andaman and Nicobar Islands</option>
                        <option value="Chandigarh">Chandigarh</option>
                        <option value="Dadra and Nagar Haveli and Daman and Diu">Dadra and Nagar Haveli and Daman and Diu</option>
                        <option value="Delhi">Delhi</option>
                        <option value="Jammu and Kashmir">Jammu and Kashmir</option>
                        <option value="Ladakh">Ladakh</option>
                        <option value="Lakshadweep">Lakshadweep</option>
                        <option value="Puducherry">Puducherry</option>
                    </select>
                </div>
                <div class="form-group">
                    <label class="form-label">Pincode</label>
                    <input type="text" class="form-input" id="newCustomerPincode" placeholder="Enter pincode">
                </div>
                <div class="form-group">
                    <label class="form-label">Mobile Number</label>
                    <input type="tel" class="form-input" id="newCustomerPhone" placeholder="Enter mobile number">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-cancel" onclick="closeCustomerModal()">Cancel</button>
                <button class="btn-modal btn-confirm" onclick="saveNewCustomer()">Add Customer</button>
            </div>
        </div>
    </div>

    <!-- Modal for Product Details -->
    <div id="productModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Add Product Details</div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Search and Select Product</label>
                    <div class="search-dropdown">
                        <input type="text" class="search-input" id="productSearch" placeholder="Search and select product" autocomplete="off">
                        <span class="search-icon">üîç</span>
                        <div class="dropdown-list" id="productDropdown"></div>
                    </div>
                </div>
                <div class="form-group">
                    <label class="form-label">Product Price (‚Çπ)</label>
                    <input type="number" class="form-input" id="modalPrice" value="0" min="0" step="0.01" onchange="calculateModalTotal()">
                </div>
                <div class="form-group">
                    <label class="form-label">Quantity</label>
                    <input type="number" class="form-input" id="modalQuantity" value="1" min="1" onchange="calculateModalTotal()">
                </div>
                <div class="form-group">
                    <label class="form-label">Total (‚Çπ)</label>
                    <input type="number" class="form-input" id="modalTotal" value="0" readonly style="background-color: #f8f9fa;">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-cancel" onclick="closeProductModal()">Cancel</button>
                <button class="btn-modal btn-confirm" onclick="addProductFromModal()">Add</button>
            </div>
        </div>
    </div>

    <!-- Modal for Payment Note -->
    <div id="paymentNoteModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">Add Payment Note</div>
            <div class="modal-body">
                <div class="form-group">
                    <label class="form-label">Payment Note</label>
                    <textarea class="form-textarea" id="paymentNoteText" rows="3" placeholder="Enter payment note or instructions"></textarea>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-cancel" onclick="closePaymentNoteModal()">Cancel</button>
                <button class="btn-modal btn-confirm" onclick="savePaymentNote()">Save Note</button>
            </div>
        </div>
    </div>

    <!-- Clear Confirmation Modal -->
    <div id="clearConfirmationModal" class="modal confirmation-modal">
        <div class="modal-content">
            <div class="modal-header">
                <span>üóëÔ∏è</span>
                Are you sure you want to clear all data?
            </div>
            <div class="modal-body">
                This action will permanently delete all customer details, products, and form data. This action cannot be undone.
            </div>
            <div class="modal-footer">
                <button class="btn-modal btn-cancel" onclick="closeClearConfirmation()">Cancel</button>
                <button class="btn-modal btn-delete" onclick="confirmClearAll()">Yes, Clear All</button>
            </div>
        </div>
    </div>

    <script>
        let products = [];
        let subtotal = 0;
        let taxApplied = false;
        let customers = [
            { name: 'Diya Punjabi', address: 'Ahmedabad', state: 'Gujarat', pincode: '380001', phone: '9876543210' },
            { name: 'Suresh Prajapati', address: 'Mumbai', state: 'Maharashtra', pincode: '400001', phone: '9876543211' },
            { name: 'Chirag Modi', address: 'Tamil Nadu', state: 'Chennai', pincode: '560001', phone: '9876543212' }
        ];
        let productList = [
            { name: 'Smartphone', price: 25000 },
            { name: 'Laptop', price: 55000 },
            { name: 'Tablet', price: 20000 },
            { name: 'Headphones', price: 3000 },
            { name: 'Digital Camera', price: 45000 },
            { name: 'Smart Watch', price: 15000 },
            { name: 'Bluetooth Speaker', price: 8000 },
            { name: 'Wireless Keyboard', price: 2500 },
            { name: 'Wireless Mouse', price: 1500 },
            { name: 'LED Monitor', price: 18000 }
        ];
        let selectedCustomer = null;
        let selectedProduct = null;

        window.onload = function() {
            updateProductTable();
            updateTotals();
            initializeSearchDropdowns();
        };

        // Initialize search dropdowns
        function initializeSearchDropdowns() {
            // Customer search dropdown
            const customerSearch = document.getElementById('customerSearch');
            const customerDropdown = document.getElementById('customerDropdown');

            customerSearch.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                filterCustomers(query);
            });

            customerSearch.addEventListener('focus', function() {
                filterCustomers('');
            });

            // Product search dropdown
            const productSearch = document.getElementById('productSearch');
            const productDropdown = document.getElementById('productDropdown');

            productSearch.addEventListener('input', function() {
                const query = this.value.toLowerCase();
                filterProducts(query);
            });

            productSearch.addEventListener('focus', function() {
                filterProducts('');
            });

            // Close dropdowns when clicking outside
            document.addEventListener('click', function(event) {
                if (!customerSearch.contains(event.target) && !customerDropdown.contains(event.target)) {
                    customerDropdown.classList.remove('show');
                }
                if (!productSearch.contains(event.target) && !productDropdown.contains(event.target)) {
                    productDropdown.classList.remove('show');
                }
            });
        }

        function filterCustomers(query) {
            const dropdown = document.getElementById('customerDropdown');
            dropdown.innerHTML = '';

            const filteredCustomers = customers.filter(customer => 
                customer.name.toLowerCase().includes(query) || 
                customer.state.toLowerCase().includes(query)
            );

            if (filteredCustomers.length === 0) {
                dropdown.innerHTML = '<div class="dropdown-item">No customers found</div>';
            } else {
                filteredCustomers.forEach(customer => {
                    const item = document.createElement('div');
                    item.className = 'dropdown-item';
                    item.textContent = `${customer.name} - ${customer.state}`;
                    item.onclick = () => selectCustomer(customer);
                    dropdown.appendChild(item);
                });
            }

            dropdown.classList.add('show');
        }

        function selectCustomer(customer) {
            selectedCustomer = customer;
            document.getElementById('customerSearch').value = `${customer.name} - ${customer.state}`;
            document.getElementById('customerDropdown').classList.remove('show');
        }

        function filterProducts(query) {
            const dropdown = document.getElementById('productDropdown');
            dropdown.innerHTML = '';

            const filteredProducts = productList.filter(product => 
                product.name.toLowerCase().includes(query)
            );

            if (filteredProducts.length === 0) {
                dropdown.innerHTML = '<div class="dropdown-item">No products found</div>';
            } else {
                filteredProducts.forEach(product => {
                    const item = document.createElement('div');
                    item.className = 'dropdown-item';
                    item.innerHTML = `${product.name} <span style="color: #666; float: right;">‚Çπ${product.price}</span>`;
                    item.onclick = () => selectProduct(product);
                    dropdown.appendChild(item);
                });
            }

            dropdown.classList.add('show');
        }

        function selectProduct(product) {
            selectedProduct = product;
            document.getElementById('productSearch').value = product.name;
            document.getElementById('modalPrice').value = product.price;
            document.getElementById('productDropdown').classList.remove('show');
            calculateModalTotal();
        }

        // Toast functionality
        function showToast(message, title = '', type = 'success') {
            const toastContainer = document.getElementById('toastContainer');
            
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            
            let icon = '‚úÖ';
            if (type === 'error') icon = '‚ùå';
            if (type === 'warning') icon = '‚ö†Ô∏è';
            
            toast.innerHTML = `
                <div class="toast-icon">${icon}</div>
                <div class="toast-content">
                    ${title ? `<div class="toast-title">${title}</div>` : ''}
                    <div class="toast-message">${message}</div>
                </div>
                <button class="toast-close" onclick="closeToast(this)">√ó</button>
            `;
            
            toastContainer.appendChild(toast);
            
            // Show toast
            setTimeout(() => toast.classList.add('show'), 100);
            
            // Auto remove after 4 seconds
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 4000);
        }

        function closeToast(button) {
            const toast = button.parentNode;
            toast.classList.remove('show');
            setTimeout(() => {
                if (toast.parentNode) {
                    toast.parentNode.removeChild(toast);
                }
            }, 300);
        }

        // Modal functionality
        function openCustomerModal() {
            document.getElementById('customerModal').classList.add('show');
        }

        function closeCustomerModal() {
            document.getElementById('customerModal').classList.remove('show');
            document.getElementById('newCustomerName').value = '';
            document.getElementById('newCustomerAddress').value = '';
            document.getElementById('newCustomerState').value = '';
            document.getElementById('newCustomerPincode').value = '';
            document.getElementById('newCustomerPhone').value = '';
        }

        function openProductModal() {
            document.getElementById('productModal').classList.add('show');
            document.getElementById('productSearch').value = '';
            document.getElementById('modalPrice').value = '0';
            document.getElementById('modalQuantity').value = '1';
            document.getElementById('modalTotal').value = '0';
            selectedProduct = null;
        }

        function closeProductModal() {
            document.getElementById('productModal').classList.remove('show');
        }

        function openPaymentNoteModal() {
            document.getElementById('paymentNoteModal').classList.add('show');
        }

        function closePaymentNoteModal() {
            document.getElementById('paymentNoteModal').classList.remove('show');
            document.getElementById('paymentNoteText').value = '';
        }

        // Clear confirmation modal functions
        function openClearConfirmation() {
            document.getElementById('clearConfirmationModal').classList.add('show');
        }

        function closeClearConfirmation() {
            document.getElementById('clearConfirmationModal').classList.remove('show');
        }

        function confirmClearAll() {
            // Clear all form fields
            document.getElementById('customerSearch').value = '';
            document.getElementById('deliveryMethod').value = '';
            document.getElementById('paymentMode').value = '';
            document.getElementById('paymentType').value = '';
            
            // Clear selected customer
            selectedCustomer = null;
            
            // Clear products
            products = [];
            subtotal = 0;
            taxApplied = false;
            
            // Reset tax button
            const taxButton = document.querySelector('.btn-apply');
            taxButton.textContent = 'Apply';
            taxButton.style.backgroundColor = '#f8f9fa';
            taxButton.style.color = '#333';
            
            updateProductTable();
            updateTotals();
            
            closeClearConfirmation();
            showToast('All data cleared successfully!', 'Cleared', 'warning');
        }

        function calculateModalTotal() {
            const price = parseFloat(document.getElementById('modalPrice').value) || 0;
            const quantity = parseInt(document.getElementById('modalQuantity').value) || 1;
            const total = price * quantity;
            document.getElementById('modalTotal').value = total.toFixed(2);
        }

        function saveNewCustomer() {
            const name = document.getElementById('newCustomerName').value.trim();
            const address = document.getElementById('newCustomerAddress').value.trim();
            const state = document.getElementById('newCustomerState').value;
            const pincode = document.getElementById('newCustomerPincode').value.trim();
            const phone = document.getElementById('newCustomerPhone').value.trim();
            
            if (!name) {
                showToast('Please enter customer name', 'Validation Error', 'error');
                return;
            }
            
            if (!address) {
                showToast('Please enter customer address', 'Validation Error', 'error');
                return;
            }
            
            if (!state) {
                showToast('Please select a state', 'Validation Error', 'error');
                return;
            }
            
            if (!phone) {
                showToast('Please enter mobile number', 'Validation Error', 'error');
                return;
            }
            
            const newCustomer = { name, address, state, pincode, phone };
            customers.push(newCustomer);
            
            closeCustomerModal();
            showToast(`Customer "${name}" added successfully!`, 'Success');
        }

        // Check if product already exists in the cart
        function findExistingProduct(productName, price) {
            return products.findIndex(product => 
                product.name.toLowerCase() === productName.toLowerCase() && 
                product.price === price
            );
        }

        function addProductFromModal() {
            const productSearch = document.getElementById('productSearch');
            const productName = productSearch.value.trim();
            const quantity = parseInt(document.getElementById('modalQuantity').value);
            const price = parseFloat(document.getElementById('modalPrice').value);
            const total = parseFloat(document.getElementById('modalTotal').value);

            if (!productName) {
                showToast('Please select a product', 'Validation Error', 'error');
                return;
            }
            
            if (quantity <= 0) {
                showToast('Quantity must be greater than 0', 'Validation Error', 'error');
                return;
            }
            
            if (price < 0) {
                showToast('Price cannot be negative', 'Validation Error', 'error');
                return;
            }

            // Check if product already exists
            const existingIndex = findExistingProduct(productName, price);
            
            if (existingIndex !== -1) {
                // Product exists, increase quantity
                products[existingIndex].quantity += quantity;
                products[existingIndex].total = products[existingIndex].price * products[existingIndex].quantity;
                showToast(`Increased quantity of "${productName}" by ${quantity}`, 'Quantity Updated');
            } else {
                // New product, add to cart
                const product = { name: productName, quantity, price, total };
                products.push(product);
                showToast(`Product "${productName}" added successfully!`, 'Product Added');
            }

            updateProductTable();
            updateTotals();
            closeProductModal();
        }

        function updateProductTable() {
            const tableBody = document.getElementById('productTableBody');

            if (products.length === 0) {
                tableBody.innerHTML = `
                    <tr>
                        <td colspan="5" class="empty-table">
                            <div class="icon">üõí</div>
                            <div>No products added yet</div>
                            <div style="font-size: 12px; margin-top: 8px;">Click "Add Product" to add items to your invoice</div>
                        </td>
                    </tr>
                `;
            } else {
                tableBody.innerHTML = products.map((product, index) => `
                    <tr>
                        <td class="product-name">${product.name}</td>
                        <td class="product-price">‚Çπ${product.price.toFixed(2)}</td>
                        <td>
                            <div class="quantity-controls">
                                <button class="quantity-btn" onclick="decreaseQuantity(${index})" title="Decrease Quantity">‚àí</button>
                                <input type="number" class="quantity-input" value="${product.quantity}" 
                                       min="1" onchange="updateQuantity(${index}, this.value)" readonly>
                                <button class="quantity-btn" onclick="increaseQuantity(${index})" title="Increase Quantity">+</button>
                            </div>
                        </td>
                        <td class="total-amount">‚Çπ${product.total.toFixed(2)}</td>
                        <td>
                            <button class="remove-btn" onclick="removeProduct(${index})" title="Remove Product">üóëÔ∏è</button>
                        </td>
                    </tr>
                `).join('');
            }
        }

        function increaseQuantity(index) {
            products[index].quantity += 1;
            products[index].total = products[index].price * products[index].quantity;
            updateProductTable();
            updateTotals();
            showToast('Quantity increased', 'Updated');
        }

        function decreaseQuantity(index) {
            if (products[index].quantity > 1) {
                products[index].quantity -= 1;
                products[index].total = products[index].price * products[index].quantity;
                updateProductTable();
                updateTotals();
                showToast('Quantity decreased', 'Updated');
            } else {
                showToast('Minimum quantity is 1', 'Cannot Decrease', 'warning');
            }
        }

        function updateQuantity(index, newQuantity) {
            const quantity = parseInt(newQuantity) || 1;
            if (quantity > 0) {
                products[index].quantity = quantity;
                products[index].total = products[index].price * quantity;
                updateProductTable();
                updateTotals();
                showToast('Quantity updated successfully', 'Updated');
            }
        }

        function removeProduct(index) {
            const productName = products[index].name;
            products.splice(index, 1);
            updateProductTable();
            updateTotals();
            showToast(`Product "${productName}" removed`, 'Product Removed', 'warning');
        }

        function updateTotals() {
            subtotal = products.reduce((sum, product) => sum + product.total, 0);
            document.getElementById('subtotal').textContent = `‚Çπ${subtotal.toFixed(2)}`;
            
            const grandTotal = taxApplied ? subtotal * 1.18 : subtotal;
            document.getElementById('grandTotal').textContent = `‚Çπ${grandTotal.toFixed(2)}`;
        }

        function applyTax() {
            if (subtotal === 0) {
                showToast('Please add products before applying tax', 'No Products', 'warning');
                return;
            }
            
            taxApplied = !taxApplied;
            const button = event.target;
            button.textContent = taxApplied ? 'Remove' : 'Apply';
            button.style.backgroundColor = taxApplied ? '#ef4444' : '#f8f9fa';
            button.style.color = taxApplied ? 'white' : '#333';
            updateTotals();
            
            const action = taxApplied ? 'applied' : 'removed';
            showToast(`Tax (18%) ${action} successfully`, 'Tax Updated');
        }

        function savePaymentNote() {
            const note = document.getElementById('paymentNoteText').value.trim();
            if (!note) {
                showToast('Please enter a payment note', 'Validation Error', 'error');
                return;
            }
            
            closePaymentNoteModal();
            showToast('Payment note saved successfully!', 'Note Saved');
        }

        function saveBill() {
            if (products.length === 0) {
                showToast('Please add at least one product to save the bill', 'No Products', 'warning');
                return;
            }
            
            if (!selectedCustomer) {
                showToast('Please select a customer', 'Customer Required', 'warning');
                return;
            }
            
            const deliveryMethod = document.getElementById('deliveryMethod').value;
            if (!deliveryMethod) {
                showToast('Please select a delivery method', 'Delivery Required', 'warning');
                return;
            }
            
            const paymentMode = document.getElementById('paymentMode').value;
            if (!paymentMode) {
                showToast('Please select a payment mode', 'Payment Required', 'warning');
                return;
            }
            
            const paymentType = document.getElementById('paymentType').value;
            if (!paymentType) {
                showToast('Please select a payment type', 'Payment Type Required', 'warning');
                return;
            }
            
            // Generate PDF
            generatePDF();
            
            showToast('Bill PDF generated and downloaded successfully!', 'Success');
        }

        // Close modals when clicking outside
        window.onclick = function(event) {
            const customerModal = document.getElementById('customerModal');
            const productModal = document.getElementById('productModal');
            const paymentNoteModal = document.getElementById('paymentNoteModal');
            const clearConfirmationModal = document.getElementById('clearConfirmationModal');
            
            if (event.target === customerModal) {
                closeCustomerModal();
            }
            if (event.target === productModal) {
                closeProductModal();
            }
            if (event.target === paymentNoteModal) {
                closePaymentNoteModal();
            }
            if (event.target === clearConfirmationModal) {
                closeClearConfirmation();
            }
        }

        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            

            doc.setFont("helvetica");  
            doc.setFontSize(24);
            doc.setTextColor(79, 70, 229); 
            doc.text('INVOICE', 20, 30);
            
            // Invoice details
            doc.setFontSize(10);
            doc.setTextColor(0, 0, 0);
            const currentDate = new Date();
            doc.text(`Invoice Date: ${currentDate.toLocaleDateString()}`, 140, 30);
            doc.text(`Invoice Time: ${currentDate.toLocaleTimeString()}`, 140, 40);
            doc.text(`Invoice #: INV-${Date.now().toString().slice(-6)}`, 140, 50);
            
            doc.setLineWidth(0.5);
            doc.line(20, 60, 190, 60);
            
            // Customer details section
            doc.setFontSize(14);
            doc.setTextColor(79, 70, 229);
            doc.text('BILL TO:', 20, 75);
            
            doc.setFontSize(11);
            doc.setTextColor(0, 0, 0);
            doc.text(selectedCustomer.name, 20, 85);
            doc.text(selectedCustomer.address, 20, 95);
            doc.text(`${selectedCustomer.state} - ${selectedCustomer.pincode}`, 20, 105);
            doc.text(`Phone: ${selectedCustomer.phone}`, 20, 115);
            
            // Payment and delivery details
            doc.setFontSize(11);
            doc.text(`Payment Mode: ${document.getElementById('paymentMode').value.toUpperCase()}`, 120, 85);
            doc.text(`Payment Type: ${document.getElementById('paymentType').value.toUpperCase()}`, 120, 95);
            doc.text(`Delivery: ${document.getElementById('deliveryMethod').value.toUpperCase()}`, 120, 105);
            
            let yPosition = 135;
            doc.setFillColor(74, 85, 104); 
            doc.rect(20, yPosition, 170, 10, 'F');
            
            doc.setFontSize(10);
            doc.setTextColor(255, 255, 255); 
            doc.text('PRODUCT NAME', 25, yPosition + 7);
            doc.text('PRICE', 90, yPosition + 7);
            doc.text('QTY', 120, yPosition + 7);
            doc.text('TOTAL', 150, yPosition + 7);
            
            // Products table rows
            yPosition += 15;
            doc.setTextColor(0, 0, 0);
            doc.setFontSize(9);
            
            products.forEach((product, index) => {
                if (index % 2 === 0) {
                    doc.setFillColor(248, 249, 250);
                    doc.rect(20, yPosition - 5, 170, 10, 'F');
                }
                
                doc.text(product.name, 25, yPosition);
                doc.text(`${product.price.toFixed(2)} /-`, 90, yPosition);
                doc.text(product.quantity.toString(), 125, yPosition);
                doc.text(`${product.total.toFixed(2)} /-`, 150, yPosition);
                
                yPosition += 12;
            });
            
            yPosition += 10;
            
            doc.setLineWidth(0.3);
            doc.line(120, yPosition, 190, yPosition);
            
            // Total section
            yPosition += 15;
            doc.setFontSize(11);
            
            const grandTotal = taxApplied ? subtotal * 1.18 : subtotal;
            
            doc.text('Subtotal:', 130, yPosition);
            doc.text(`${subtotal.toFixed(2)} /-`, 160, yPosition);
            
            if (taxApplied) {
                yPosition += 10;
                const taxAmount = subtotal * 0.18;
                doc.text('Tax (18%):', 130, yPosition);
                doc.text(`${taxAmount.toFixed(2)} /-`, 160, yPosition);
            }
            
            // Grand total 
            yPosition += 15;
            doc.setFillColor(79, 70, 229);
            doc.rect(120, yPosition - 8, 70, 12, 'F');
            
            doc.setFontSize(12);
            doc.setTextColor(255, 255, 255);
            doc.text('GRAND TOTAL:', 125, yPosition);
            doc.text(`${grandTotal.toFixed(2)} /-`, 160, yPosition);
            
            // Footer
            doc.setFontSize(10);
            doc.setTextColor(128, 128, 128);
            doc.text('Thank you for your purchase. Do visit again!', 20, 280);
            doc.text('This is a computer generated invoice.', 20, 290);
            
            // Generate filename and save
            const filename = `Invoice_${selectedCustomer.name.replace(/\s+/g, '_')}_${Date.now()}.pdf`;
            doc.save(filename);
        }
    </script>
</body>
</html>